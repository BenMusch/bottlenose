<% @page_title = "#{@course.name}: Investigate partners" %>
<style>
  .older-team {
  background: linear-gradient(to right, white, #dff0d8);
  }
  .newer-team {
  background: linear-gradient(to left, white, #dff0d8);
  }
</style>
<% @sorted_users = @all_users.sort_by{|uid, u| u.sort_name}.map(&:first)
   @all_users = @all_users.map do |uid, u|
     [uid, {profile: user_image(u), name: u.display_name}]
   end.to_h %>
<script>
  var assignmentNames = <%= raw json_escape(JSON.generate(@assignment_names)) %>;
  var allUsers = <%= raw json_escape(JSON.generate(@all_users).gsub("},", "},\n")) %>;
  var allTeams = <%= raw json_escape(JSON.generate(@all_teams).gsub("},", "},\n")) %>;
  var userPath = "<%= user_path(id: '(uid)') %>";
  var teamPath = "<%= course_teamset_team_path(course_id: @course.id, teamset_id: '(tsid)', id: '(tid)') %>";
  function showUser(uid, u) {
    return $("<a>").attr("href", userPath.replace("(uid)", uid)).text(u.name).addClass("user-link")
                   .attr("title", $("<img>").attr("src", u.profile).attr("alt", u.name)
                                            .attr("style", 'max-height: 300px; max-width: 300px;')[0].outerHTML)
                   .data("toggle", "tooltip").data("delay", {show: 0, hide: 250})
                   .data('html', true).tooltip('fixTitle');
  }
  function linkTeam(tid, terse) {
    if (tid && allTeams[tid]) {
      return $("<a>").attr("href", teamPath.replace('(tsid)', allTeams[tid].ts_id).replace('(tid)', tid))
                     .text(terse ? "Team " + tid : allTeams[tid].desc);
    } else {
      return $("<span>").text("<none>");
    }
  }  
</script>
<div>
  <ul class="nav nav-tabs">
    <li class="active"><a href="#common-partners" data-toggle="tab">Find common partners</a></li>
    <li><a href="#diff-teamsets" data-toggle="tab">Compare teamsets</a></li>
  </ul>

  <div class="tab-content">
    <%= render 'common_partners' %>
    <%= render 'diff_teamsets' %>
  </div>
</div>
